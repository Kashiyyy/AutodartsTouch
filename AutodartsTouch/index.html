<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Kiosk Toolbar</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
<style>
html,body{margin:0;height:100%;background:transparent;font-family:'Open Sans',sans-serif}
#toolbar{
  position:fixed; top:0; left:0; right:0; height:72px;
  display:grid; grid-template-columns:80px 1fr 80px; align-items:center; padding:0 12px; z-index:99999;
  background-image:
    radial-gradient(50% 30% at 86% 0%, #313370e3, #40348600),
    radial-gradient(50% 70% at 70% 22%, #26599ae6, #40348600),
    radial-gradient(50% 70% at 112% 44%, #2c436cd9, #40348600),
    radial-gradient(90% 90% at -12% 89%, #0f2f50e0, #40348600),
    radial-gradient(50% 70% at -2% 53%, #34205fe3, #40348600),
    radial-gradient(50% 70% at 36% 22%, #403486d4, #40348600),
    radial-gradient(50% 40% at 66% 59%, #206fb9de 7%, #206fb900),
    radial-gradient(75% 75% at 50% 50%, #3662b9 1%, #2d285b);
  background-repeat:no-repeat;background-size:cover;
}
button{font-family:'Open Sans',sans-serif;font-size:20px;padding:0 12px;border:none;background:none;color:#fff;cursor:pointer}
button:hover{color:#e0e0e0}
#tabs{display:flex;justify-content:space-evenly;gap:16px;align-items:center;height:100%}
.sidebtn{width:40px;height:56px;background:transparent;color:#fff;font-size:24px;border:none;padding:0}
button[aria-selected="true"]::after{content:"";display:block;margin:2px auto 0 auto;width:66%;height:2px;background:#fff;border-radius:1px}
</style>
</head>
<body>
  <div id="toolbar" role="toolbar" aria-label="Kiosk Controls">
    <div style="display:flex;align-items:center;justify-content:center;">
      <button class="sidebtn" id="webVKBtn" aria-label="Web Keyboard">&#x2328;</button>
    </div>

    <div id="tabs" role="tablist" aria-label="Pages">
      <!-- Tabs will be dynamically inserted here -->
    </div>

    <div style="display:flex;align-items:center;justify-content:center;">
      <button class="sidebtn" id="settingsBtn" aria-label="Settings">&#x2699;</button>
      <button class="sidebtn" id="refreshBtn" aria-label="Refresh">&#x27F3;</button>
    </div>
  </div>

<script>
  let tabButtons = [];

  function setActive(id) {
    tabButtons.forEach(t => {
      t.setAttribute('aria-selected', t.id === id ? 'true' : 'false');
    });
  }

  function switchTab(tabId) {
    setActive(tabId);
    if (window.api && window.api.switchTab) {
      window.api.switchTab(tabId);
    }
  }

  async function generateTabs() {
    const tabsContainer = document.getElementById('tabs');
    if (window.api && window.api.getTabs) {
      const tabs = await window.api.getTabs();
      tabs.forEach((tab, index) => {
        if (tab.url) { // Only show tabs that have a URL
          const button = document.createElement('button');
          const tabId = `tab${index}`;
          button.id = tabId;
          button.textContent = tab.name || `Tab ${index + 1}`;
          button.setAttribute('role', 'tab');
          button.setAttribute('aria-selected', 'false');
          button.onclick = () => switchTab(tabId);
          tabsContainer.appendChild(button);
          tabButtons.push(button);
        }
      });

      // Set the first tab as active by default
      if (tabButtons.length > 0) {
        setActive(tabButtons[0].id);
      }
    }
  }

  document.addEventListener('DOMContentLoaded', generateTabs);

  const webVKBtn = document.getElementById('webVKBtn');
  webVKBtn.addEventListener('pointerdown', (e) => { e.preventDefault(); if (window.api && window.api.toggleWebKeyboard) window.api.toggleWebKeyboard(); });
  webVKBtn.addEventListener('click', (e) => e.preventDefault());

  const settingsBtn = document.getElementById('settingsBtn');
  settingsBtn.addEventListener('click', () => {
    if (window.api && window.api.openSettings) {
      window.api.openSettings();
    }
  });

  const refreshBtn = document.getElementById('refreshBtn');
  let pressTimer = null;

  refreshBtn.addEventListener('pointerdown', (e) => {
    e.preventDefault();
    pressTimer = window.setTimeout(() => {
      if (window.api && window.api.forceReload) {
        window.api.forceReload();
      }
      pressTimer = null;
    }, 800); // 800ms for long press
  });

  refreshBtn.addEventListener('pointerup', (e) => {
    e.preventDefault();
    if (pressTimer) {
      clearTimeout(pressTimer);
      pressTimer = null;
      if (window.api && window.api.refresh) {
        window.api.refresh();
      }
    }
  });

  refreshBtn.addEventListener('pointerleave', () => {
    if (pressTimer) {
      clearTimeout(pressTimer);
      pressTimer = null;
    }
  });

  // Detect touch and hide cursor
  function onFirstTouch() {
    if (window.api && window.api.notifyTouchUsed) {
      window.api.notifyTouchUsed();
    }
    // Remove listener so it only fires once
    window.removeEventListener('touchstart', onFirstTouch, false);
  }
  window.addEventListener('touchstart', onFirstTouch, false);
</script>
</body>
</html>